{- |
Calculator - 计算器核心逻辑
===========================

TDD 练习：测试驱动开发
按照 TDD 循环实现：Red -> Green -> Refactor
-}

module Calculator
  ( add
  , subtract
  , multiply
  , divide
  , power
  , sqrt
  ) where

import Prelude hiding (subtract, sqrt)
import Calculator.Types

-- ============================================================================
-- 第 1 轮 TDD: 加法
-- ============================================================================

-- TODO: 实现加法
-- |
-- 两个数相加
--
-- TDD 步骤:
-- 1. 先在测试中写：add 2 3 `shouldBe` Right 5
-- 2. 实现最简单的代码让测试通过：add _ _ = Right 5
-- 3. 添加更多测试：add 10 20 `shouldBe` Right 30
-- 4. 实现正确的逻辑：add x y = Right (x + y)
-- 5. 检查是否需要重构
add :: Double -> Double -> CalcResult
add = undefined
-- 提示: 先硬编码返回值，让第一个测试通过
-- 然后实现真正的逻辑


-- ============================================================================
-- 第 2 轮 TDD: 减法
-- ============================================================================

-- TODO: 实现减法
-- |
-- 两个数相减
subtract :: Double -> Double -> CalcResult
subtract = undefined


-- ============================================================================
-- 第 3 轮 TDD: 乘法
-- ============================================================================

-- TODO: 实现乘法
-- |
-- 两个数相乘
multiply :: Double -> Double -> CalcResult
multiply = undefined


-- ============================================================================
-- 第 4 轮 TDD: 除法（带错误处理）
-- ============================================================================

-- TODO: 实现除法
-- |
-- 除法，需要处理除零错误
--
-- TDD 步骤:
-- 1. 测试正常情况：divide 10 2 `shouldBe` Right 5
-- 2. 测试除零：divide 10 0 `shouldBe` Left DivisionByZero
-- 3. 实现逻辑
divide :: Double -> Double -> CalcResult
divide = undefined
-- 提示: 检查除数是否为 0


-- ============================================================================
-- 第 5 轮 TDD: 幂运算（可选）
-- ============================================================================

-- TODO: 实现幂运算
-- |
-- 计算 x 的 y 次方
--
-- 可能的错误：
-- - 溢出（结果太大）
power :: Double -> Double -> CalcResult
power = undefined
-- 提示: 使用 ** 运算符，检查是否 isInfinite


-- ============================================================================
-- 第 6 轮 TDD: 平方根（可选）
-- ============================================================================

-- TODO: 实现平方根
-- |
-- 计算平方根
--
-- 错误处理：
-- - 负数应该返回错误
sqrt :: Double -> CalcResult
sqrt = undefined
-- 提示: 检查是否 < 0


-- ============================================================================
-- 辅助函数
-- ============================================================================

-- 检查是否溢出
isOverflow :: Double -> Bool
isOverflow x = isInfinite x || isNaN x

-- 检查是否下溢
isUnderflow :: Double -> Bool
isUnderflow x = x == 0 && x /= 0  -- 很小的数变成 0


{-
TDD 实践指南：

1. Red (红灯)：
   - 先写一个失败的测试
   - 确保测试确实失败了

2. Green (绿灯)：
   - 写最少的代码让测试通过
   - 可以先硬编码！

3. Refactor (重构)：
   - 测试通过后，改进代码
   - 确保测试仍然通过

4. 重复：
   - 继续下一个功能

示例：
-- Red: 写测试
it "adds two numbers" $
  add 2 3 `shouldBe` Right 5

-- Green: 最简实现
add _ _ = Right 5  -- 硬编码！但测试通过了

-- 添加更多测试
it "adds different numbers" $
  add 10 20 `shouldBe` Right 30  -- 现在失败了！

-- Green: 正确实现
add x y = Right (x + y)  -- 所有测试通过

-- Refactor: 重构（如果需要）
-- 在这个例子中，代码已经很简单了

实践建议：
- 每次只添加一个测试
- 小步迭代
- 不要一次写太多代码
- 先让测试通过，再考虑优化
-}

